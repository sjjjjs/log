{"version":3,"sources":["page/logCreate.module.css","component/logEditor/index.module.css","component/logComments/index.module.css","component/appFrame/index.js","util/getUrlUtil.js","component/normalNavigator/index.js","store/index.js","service/log.js","service/textToIdMap.js","util/toaster.js","util/commonUtil.js","page/alia.js","component/markdownPreview/index.js","component/logItem/index.js","page/log.js","component/markdownEditor/index.js","component/logCommentEditor/index.js","service/logComment.js","page/logCommentCreate.js","component/logEditor/index.js","page/logCreate.js","component/timeAgo/index.js","component/logComments/index.js","util/sourcePosUtil.js","component/drawerEditor/index.js","page/logDetail.js","App.js","serviceWorker.js","index.js","page/logDetail.module.css","component/appFrame/index.module.css","component/markdownPreview/index.module.css","component/logItem/index.module.css","component/markdownEditor/index.module.css","page/alia.module.css","page/log.module.css","page/logCommentCreate.module.css","component/logCommentEditor/index.module.css"],"names":["module","exports","props","className","styles","container","header","body","children","footer","id","text","NormalNavigator","showBack","showHome","title","actions","leftActions","h","useHistory","style","userSelect","maxWidth","margin","align","onClick","goBack","icon","minimal","push","getUrlUtil","dayjs","Date","now","format","content","showActionsBar","shortcuts","highlightCurrentDay","onChange","evt","rightIcon","db","Dexie","version","stores","logs","logComments","textToIdMap","store","get","Number","logInfo","add","time","delete","update","orderBy","toArray","then","l","reverse","where","first","match","catch","lid","item","AppToaster","Toaster","create","position","Position","TOP","noop","delay","ms","Promise","resolve","setTimeout","createAndLink","a","success","t","logService","textToIdMapService","show","timeout","message","intent","createAndUpdateLink","Alia","params","useParams","isValidText","useState","isTextExist","setIsTextExist","isTextExistInit","setIsTextExistInit","isLogExist","setIsLogExist","isLogExistInit","setIsLogExistInit","isInit","useEffect","map","log","replace","validate","large","description","action","extra","MarkdownPreview","source","rsource","selectAble","m","p1","p2","generatLinks","sepIdx","indexOf","slice","names","markdownBody","active","onSelect","preventDefault","el","findTopLevelEle","target","HTMLElement","parentNode","classList","contains","pnode","parentElement","sourcePosStr","getAttribute","short","sourcePos","meta","Classes","TEXT_MUTED","TEXT_SMALL","datetime","date","locale","elevation","Elevation","ONE","interactive","Log","setlogs","list","fetch","key","value","onSubmit","placeholder","inputRef","setInputRef","rSelection","selection","JSON","parse","setSelectionRange","from","to","setAttribute","editorBox","ref","fill","autoFocus","growVertically","onKeyUp","keyCode","altKey","width","maxHeight","resize","onKeyDown","start","selectionStart","end","selectionEnd","linesBegin","substring","lastIndexOf","selected","window","getSelection","toString","expandSelected","shiftKey","stringify","test","length","LogCommentEditor","onConfirm","val","logCommentInfo","LogCommentCreate","cid","initState","setInitState","isNew","setIsNew","setValue","logCommentService","finally","err","alert","LogEditor","LogCreate","showTooltip","disabled","LogComment","c","comment","onRequestDelete","onRequestUpdate","commentMeta","commentMetaBlock","commentMetaItem","hoverVisible","interactionKind","commentContent","RUNNING_TEXT","LogComments","comments","REG","getRange","sourceArr","split","exec","startLine","startIndex","endLine","endIndex","sourcePosParse","reduce","p","n","DrawerEditor","isOpen","onClose","hasBackdrop","BOTTOM","size","DRAWER_BODY","height","padding","display","alignItems","DIALOG_CLOSE_BUTTON","NavigationActions","onAppendRequest","label","Divider","confirm","LogDetail","flag","setFlag","logData","setLogData","logCommentsData","setLogCommentsData","partialEdit","setPartialEdit","isOpenPartialDrawerEditor","setIsOpenPartialDrawerEditor","isOpenAppendDrawerEditor","setIsOpenAppendDrawerEditor","isOpenCommentDrawerEditor","setIsOpenCommentDrawerEditor","partialSource","setPartialSource","appendSource","setAppendSource","commentSource","setCommentSource","commentRefId","setCommentRefId","posData","setPosData","logCommentsInfo","fetchData","marginLeft","marginBottom","checked","logContentBox","logContent","pos","partial","range","sliceCodeFromSource","commentBox","replacement","replaceCodeFromSource","App","path","component","LogPage","LogDetailPage","AliaPage","LogCreatePage","LogCommentCreatePage","Boolean","location","hostname","ReactDOM","render","document","getElementById","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.641cea95.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"logCreate_container__19vSt\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"textarea\":\"logEditor_textarea__28vya\",\"container\":\"logEditor_container__1GeHV\",\"buttonWrap\":\"logEditor_buttonWrap__1W5No\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"comments\":\"logComments_comments__1LjH6\",\"comment\":\"logComments_comment__GP3sS\",\"commentTime\":\"logComments_commentTime__3ccqY\",\"commentMeta\":\"logComments_commentMeta__2p6gN\",\"commentMetaItem\":\"logComments_commentMetaItem__2-ZM7\"};","import React from 'react';\nimport styles from './index.module.css';\n\nexport default function(props) {\n    return (\n        <div className={styles.container}>\n            { props.header && <div className={styles.header}>{props.header}</div> }\n            <div className={styles.body}>{props.children}</div>\n            { props.footer && <div className={styles.footer}>{props.footer}</div> }\n        </div>\n    );\n}","\nexport default {\n    getLogUrl: () => `/l`,\n    getLogDetailUrl: (id) => `/l/d/${id}`,\n    getAliaUrl: text => `/l/a/${text}`,\n    getLogCreateUrl: (id = '') => `/l/ce/${id}`,\n    getLogCommentCreateUrl: (id, cid = '') => `/l/lc/ce/${id}/${cid}`\n}\n","\nimport React from 'react';\nimport { useHistory } from 'react-router-dom';\nimport {\n    Navbar, NavbarGroup, Button, NavbarHeading, NavbarDivider, ButtonGroup, Popover\n} from '@blueprintjs/core';\nimport { DatePicker } from '@blueprintjs/datetime';\nimport getUrlUtil from 'util/getUrlUtil';\nimport dayjs from 'dayjs';\n\nexport default function NormalNavigator(props) {\n    const { showBack = false, showHome = true, title = '', actions = null, leftActions = null } = props;\n    const h = useHistory();\n    return (\n        <Navbar style={{ userSelect: 'none'}}>\n            <div style={{ maxWidth: 640, margin: 'auto' }}>\n                <NavbarGroup align=\"left\">\n                    <ButtonGroup>\n                        {\n                            showBack &&\n                                <Button\n                                    onClick={() => h.goBack()}\n                                    icon=\"chevron-left\"\n                                    minimal\n                                >返回</Button>\n                        }\n                        {\n                            showHome &&\n                            <Button\n                                minimal\n                                icon=\"home\"\n                                onClick={() => h.push(getUrlUtil.getLogUrl())}\n                                text=\"主页\"\n                            />\n                        }\n                        <ButtonGroup>\n                            <Button icon=\"book\" minimal text=\"日记\" onClick={() => {\n                                h.push(getUrlUtil.getAliaUrl(dayjs(Date.now()).format('YYYYMMDD')));\n                            }} />\n                            <Popover content={\n                                <DatePicker\n                                    showActionsBar\n                                    shortcuts\n                                    highlightCurrentDay\n                                    onChange={evt => {\n                                        evt && h.push( getUrlUtil.getAliaUrl(dayjs(evt).format('YYYYMMDD')));\n                                    }}\n                                />\n                            }>\n                                <Button minimal rightIcon=\"caret-down\" />\n                            </Popover>\n                        </ButtonGroup>\n                    </ButtonGroup>\n                    {\n                        leftActions && <>\n                            <NavbarDivider />\n                            {leftActions}\n                        </>\n                    }\n                    {\n                        title !== '' && <>\n                            <NavbarDivider />\n                            <NavbarHeading>{title}</NavbarHeading>\n                        </>\n                    }\n                </NavbarGroup>\n                <NavbarGroup align=\"right\">\n                    {actions}\n                </NavbarGroup>\n            </div>\n        </Navbar>\n    );\n}","import Dexie from 'dexie';\n\nconst db = new Dexie('EfficientDatabase');\n\ndb.version(1).stores({\n    logs: '++id, content, time'\n});\n\ndb.version(2).stores({\n    logComments: '++id, content, time, lid'\n});\n\ndb.version(3).stores({\n    textToIdMap: '++id, &text, lid'\n});\n\nexport default db;\n\n// import SyncClient from 'sync-client';\n// // SyncClient is a subclass of Dexie\n\n// const databaseName = 'testDB'; // The name for the indexedDB database\n// const versions = [\n//     {\n//         version: 1,\n//         stores: {\n//           logs: '++id, content, time'\n//         }\n//     }, {\n//         version: 2,\n//         stores: {\n//             logComments: '++id, content, time, lid'\n//         }\n//     }, {\n//         version: 3,\n//         stores: {\n//             textToIdMap: '++id, &text, lid'\n//         }\n//     }\n// ];\n\n// const syncClient = new SyncClient(databaseName, versions, {\n\n// });\n\n// export default syncClient;\n// window.syncClient = syncClient;\n\n// syncClient.syncable.connect('sync_client_protocol', 'http://127.0.0.1:3000');\n// syncClient.syncable.on('statusChanged', function (newStatus, url) {\n//     console.log (\"Sync Status changed: \" + newStatus, url);\n// });","import store from 'store/index';\n\nconst get = (id) => store.logs.get(Number(id));\n\nconst add = (logInfo) => store.logs.add({...logInfo, time: new Date()});\n\nconst del = (id) => store.logs.delete(Number(id));\n\nconst upd = (id, logInfo) => store.logs.update(Number(id), logInfo);\n\nconst all = () => store.logs.orderBy('time').toArray().then(l => l.reverse());\n\nexport default {\n    get, add, del, upd, all\n}","import store from 'store/index';\n\nconst findMapByText = text => store\n    .textToIdMap\n    .where({text})\n    .first(match => match)\n    .catch(() => null);\n\nconst link = (text, lid) => store.textToIdMap.add({ text, lid });\nconst relink = (text, lid) => store.textToIdMap.where({ text }).first(item => store.textToIdMap.update(item.id, { lid }));\n\nexport default {\n    findMapByText,\n    link,\n    relink\n};","import { Position, Toaster } from \"@blueprintjs/core\";\n \n\nexport const AppToaster = Toaster.create({\n    className: \"recipe-toaster\",\n    position: Position.TOP\n});","\nexport const noop = () => false;\n\nexport const delay = ms => new Promise(resolve => {\n    setTimeout(resolve, ms);\n});","\nimport React, { useEffect, useState } from 'react';\nimport { useParams, useHistory } from 'react-router-dom';\nimport AppFrame from 'component/appFrame';\nimport NormalNavigator from 'component/normalNavigator';\nimport logService from 'service/log';\nimport textToIdMapService from 'service/textToIdMap';\nimport styles from './alia.module.css';\nimport { Button, NonIdealState, Tag, Spinner } from '@blueprintjs/core';\nimport { AppToaster } from 'util/toaster';\nimport getUrlUtil from 'util/getUrlUtil';\nimport { delay } from 'util/commonUtil';\n\nconst createAndLink = async (text) => {\n    let success = true;\n    let lid;\n    let t = '';\n    if (text === 'm') { t = '美好的一天！' }\n    try {\n        lid = await logService.add({ content: t || text + '\\n---\\n' });\n        await textToIdMapService.link(text, lid);\n    } catch(err) {\n        AppToaster.show({ timeout: 2000, message: err.message, intent: 'danger' });\n        success = false;\n    }\n    return success ? lid : null;\n}\nconst createAndUpdateLink = async (text) => {\n    let success = true;\n    let lid;\n    let t = '';\n    if (text === 'm') { t = '美好的一天！' }\n    try {\n        lid = await logService.add({ content: t || text + '\\n---\\n' });\n        await textToIdMapService.relink(text, lid);\n    } catch(err) {\n        AppToaster.show({ timeout: 2000, message: err.message, intent: 'danger' });\n        success = false;\n    }\n    return success ? lid : null;\n}\n\nexport default function Alia() {\n    const TEXT_REG = /^\\S{1,100}$/;\n    const params = useParams();\n    const h = useHistory();\n    const { text = '' } = params;\n    const isValidText = text.match(TEXT_REG);\n    const [ isTextExist, setIsTextExist ] = useState(false);\n    const [ isTextExistInit, setIsTextExistInit ] = useState(false);\n    const [ isLogExist, setIsLogExist ] = useState(false);\n    const [ isLogExistInit, setIsLogExistInit ] = useState(false);\n    const isInit = isTextExistInit && isLogExistInit;\n\n    useEffect(() => {\n        async function validate() {\n            await delay(350);\n            const map = await textToIdMapService.findMapByText(text);\n            if (map) {\n                setIsTextExist(true);\n                const log = await logService.get(map.lid);\n                if (log) {\n                    setIsLogExist(true);\n                    h.replace(getUrlUtil.getLogDetailUrl(log.id));\n                    return;\n                }\n            }\n            setIsTextExistInit(true);\n            setIsLogExistInit(true);\n        }\n        validate();\n    }, [ text, h ]);\n\n    const title = <Tag intent=\"warning\" minimal large >{text}</Tag>;\n    let icon = '';\n    let description = '';\n    let action = null;\n\n    if (!isValidText) {\n        icon=\"error\";\n        description = \"格式不正确\";\n        action = null;\n    } else {\n        if (!isTextExist) {\n            icon = \"info-sign\";\n            description = \"此关键字尚未关联任何日志\";\n            action = <Button minimal onClick={() => createAndLink(text).then(lid => lid && h.replace(getUrlUtil.getLogDetailUrl(lid)))} intent=\"primary\">新建日志并关联</Button>;\n\n            if (text === 'm') {\n                icon = \"play\";\n                description = \"欢迎使用，开始创建你的第一篇日志吧！\";\n                action = <Button minimal onClick={() => createAndLink(text).then(lid => lid && h.replace(getUrlUtil.getLogDetailUrl(lid)))} intent=\"primary\">开启日志</Button>;\n            }\n        } else {\n            if (!isLogExist) {\n                icon = \"warning-sign\";\n                description = \"哎呀，首页的日志被删除了！\";\n                action = <Button minimal onClick={() => createAndUpdateLink(text).then(lid => lid && h.replace(getUrlUtil.getLogDetailUrl(lid)))} intent=\"primary\">新建日志并重新关联</Button>;\n\n                if (text === 'm') {\n                    icon = \"warning-sign\";\n                    description = \"日志消失了，重新关联吧！\";\n                    action = <Button minimal onClick={() => createAndUpdateLink(text).then(lid => lid && h.replace(getUrlUtil.getLogDetailUrl(lid)))} intent=\"primary\">新建日志并重新关联</Button>;\n                }\n            }\n        }\n    }\n\n    return (\n        <AppFrame header={\n            <NormalNavigator\n                showBack={text !== 'm'}\n                title=\"暂未关联日志\"\n            />\n        }>\n            <div className={styles.container}>\n                {\n                    !isInit && <Spinner />\n                }\n                {\n                    isInit && <NonIdealState\n                        icon={icon}\n                        title={title}\n                        action={action}\n                        extra={description}\n                    >\n                    </NonIdealState>\n                }\n            </div>\n        </AppFrame>\n    );\n}\n","import React from 'react';\nimport ReactMarkdown from 'react-markdown';\nimport names from 'classnames';\nimport styles from './index.module.css';\n\nconst SEGMENT = '\\n---';\n\nfunction findTopLevelEle(target) {\n    if (!(target instanceof HTMLElement)) return null;\n    if (!(target.parentNode instanceof HTMLElement)) return null;\n    if (target.classList.contains(styles.markdownBody)) return null;\n    const pnode = target.parentElement;\n    if (pnode.classList.contains(styles.markdownBody)) {\n        return target;\n    }\n    return findTopLevelEle(pnode);\n}\nfunction generatLinks(source) {\n    return source.replace(/(.?)#([A-Za-z0-9_\\u4E00-\\u9FA5]{1,100})/g, (m, p1, p2) => {\n        if (p1 === '\\\\') {\n            return '#' + p2;\n        }\n        return `${p1}[${m}](#/l/a/${p2})`;\n    });\n}\n\nexport default function MarkdownPreview(props) {\n    const { source: rsource = '', className, selectAble = false } = props;\n    const source = generatLinks(rsource);\n    const sepIdx = source.indexOf(SEGMENT);\n    const title = sepIdx > 0 ? source.slice(0, sepIdx) : '';\n    return (\n        <div\n            className={names(\n                \"markdown-body\",\n                className,\n                styles.markdownBody,\n                selectAble ? styles.active : ''\n            )}\n            onClick={evt => {\n                if (!props.selectAble || typeof props.onSelect !== 'function') return;\n                evt.preventDefault();\n                const el = findTopLevelEle(evt.target);\n                if (!el) return;\n                const sourcePosStr = el.getAttribute('data-sourcePos');\n                props.onSelect(sourcePosStr);\n            }}\n        >\n            <ReactMarkdown\n                source={props.short ? (title || source) : source}\n                sourcePos={selectAble}\n            />\n        </div>\n    );\n}","/* eslint-disable jsx-a11y/anchor-is-valid  */\n\nimport React from 'react';\nimport TimeAgo from 'timeago-react';\nimport { useHistory } from 'react-router-dom';\nimport { Card, Classes, Elevation } from '@blueprintjs/core';\nimport names from 'classnames';\nimport styles from './index.module.css';\nimport MarkdownPreview from 'component/markdownPreview';\nimport getUrlUtil from 'util/getUrlUtil';\n\nexport default function (props) {\n    const h = useHistory();\n    return (\n        <div className={styles.container}>\n            <div className={styles.meta}>\n                <span className={names(Classes.TEXT_MUTED, Classes.TEXT_SMALL)}>\n                    <TimeAgo datetime={props.date} locale='zh_CN' />\n                </span>\n            </div>\n            <Card elevation={Elevation.ONE} interactive onClick={() => h.push(getUrlUtil.getLogDetailUrl(props.id))}>\n                <div className={names(\"markdown-body\", styles.markdownBody)}>\n                    <MarkdownPreview source={props.children} short />\n                </div>\n            </Card>\n        </div>\n    );\n}","import React, { useEffect, useState } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { Button } from '@blueprintjs/core';\nimport styles from './log.module.css';\nimport LogItem from 'component/logItem';\nimport AppFrame from 'component/appFrame';\nimport logService from 'service/log';\nimport NormalNavigator from 'component/normalNavigator';\nimport getUrlUtil from 'util/getUrlUtil';\n\nexport default function Log() {\n    const h = useHistory();\n    const [logs, setlogs] = useState([]);\n    useEffect(() => {\n        async function fetch() {\n            const list = await logService.all();\n            setlogs(list);\n        }\n        fetch();\n    }, []);\n    return (\n        <AppFrame header={\n            <NormalNavigator showBack title=\"日志管理\" actions={\n                <Button\n                    minimal intent=\"primary\" icon=\"annotation\"\n                    onClick={() => h.push(getUrlUtil.getLogCreateUrl())}\n                >创建日志</Button>\n            } />\n        }>\n            <div className={styles.container}>\n                {\n                    logs.map(message => (\n                        <LogItem\n                            key={message.id}\n                            id={message.id}\n                            date={message.time}\n                        >{message.content}</LogItem>\n                    ))\n                }\n            </div>\n        </AppFrame>\n    );\n}\n","import React, { useEffect, useState } from 'react';\nimport styles from './index.module.css';\nimport { TextArea } from '@blueprintjs/core';\nimport { noop } from 'util/commonUtil';\n\nexport default function(props) {\n    const {\n        value = '',\n        onChange = noop,\n        onSubmit = noop,\n        placeholder = ''\n    } = props;\n    const [inputRef, setInputRef] = useState(null);\n    const rSelection = inputRef ? inputRef.getAttribute('data-selection') : '';\n    useEffect(() => {\n        if (rSelection) {\n            const selection = JSON.parse(rSelection);\n            inputRef.setSelectionRange(selection.from, selection.to);\n            inputRef.setAttribute('data-selection', '');\n        }\n    }, [ inputRef, rSelection ]);\n    return (\n        <div className={styles.container}>\n            <div className={styles.editorBox}>\n                <TextArea\n                    inputRef={ref => setInputRef(ref)}\n                    fill large\n                    autoFocus\n                    value={value}\n                    growVertically\n                    placeholder={placeholder}\n                    onChange={evt => onChange(evt.target.value)}\n                    onKeyUp={evt => {\n                        if (evt.keyCode === 13 && evt.altKey === true) {\n                            onSubmit();\n                        }\n                    }}\n                    style={{width: '100%', maxHeight: '65vh', resize: 'none'}}\n                    onKeyDown={evt => {\n                        if (evt.keyCode === 9) {\n                            evt.preventDefault();\n                            const el = evt.target;\n                            const indent = '    ';\n                            const start = el.selectionStart;\n                            const end = el.selectionEnd;\n                            const head = value.substring(0, start);\n                            const linesBegin = head.lastIndexOf('\\n') + 1;\n                            let selected = window.getSelection().toString();\n                            let expandSelected = value.slice(linesBegin, end);\n                            if (evt.shiftKey) {\n                                selected = expandSelected.replace(/^\\s{4}/, '').replace(/\\n\\s{4}/g, '\\n');\n                                onChange(value.substring(0, linesBegin) + selected + value.substring(end));\n                                inputRef.setAttribute('data-selection', JSON.stringify({\n                                    from: start - (/^\\s{4}/.test(expandSelected) ? indent.length : 0),\n                                    to: linesBegin + selected.length\n                                }));\n                            } else {\n                                expandSelected = indent + expandSelected.replace(/\\n/g, '\\n' + indent);\n                                onChange(value.substring(0, linesBegin) + expandSelected + value.substring(end));\n                                inputRef.setAttribute('data-selection', JSON.stringify({\n                                    from: start + indent.length,\n                                    to: linesBegin + expandSelected.length + indent\n                                }));\n                            }\n                        }\n                    }}\n                />\n            </div>\n        </div>\n    );\n}\n","import React from 'react';\nimport styles from './index.module.css';\nimport { noop } from 'util/commonUtil';\nimport MarkdownEditor from 'component/markdownEditor';\n\nexport default function LogCommentEditor (props) {\n    const { value = '', onChange = noop, placeholder = '', onConfirm = noop } = props;\n\n    return (\n        <div className={styles.container}>\n            <MarkdownEditor\n                value={value}\n                placeholder={placeholder}\n                onChange={val => onChange(val)}\n                onSubmit={() => onConfirm()}\n            />\n        </div>\n    );\n}","import store from 'store/index';\n\nconst get = (id) => store.logComments.get(Number(id));\n\nconst add = (id, logCommentInfo) => store.logComments.add({...logCommentInfo, lid: Number(id), time: new Date()});\n\nconst del = (id) => store.logComments.delete(Number(id));\n\nconst upd = (id, logCommentInfo) => store.logComments.update(Number(id), logCommentInfo);\n\nconst all = (id) => store.logComments.where({ lid: Number(id) }).toArray();\n\nexport default {\n    get, add, del, upd, all\n}","import React, { useState, useEffect} from 'react';\nimport { useHistory, useParams } from 'react-router-dom';\nimport { Button } from '@blueprintjs/core';\nimport styles from './logCommentCreate.module.css';\nimport LogCommentEditor from 'component/logCommentEditor';\nimport AppFrame from 'component/appFrame';\nimport NormalNavigation from 'component/normalNavigator';\nimport logCommentService from 'service/logComment';\n\nexport default function LogCommentCreate() {\n    const params = useParams();\n    const { id = null, cid = null } = params;\n    const [ initState, setInitState ] = useState(false);\n    const [ isNew, setIsNew ] = useState(true);\n    const [ value, setValue ] = useState('');\n    const h = useHistory();\n\n    useEffect(() => {\n        (async function() {\n            if (!cid) {\n                setInitState(true);\n                return;\n            };\n            logCommentService.get(cid)\n                .then(m => {\n                    m && setValue(m.content);\n                    setIsNew(false);\n                })\n                .finally(() => {\n                    setInitState(true);\n                });\n        })();\n    }, [ cid ]);\n    return (\n        <AppFrame header={\n            <NormalNavigation showBack title=\"评论\" actions={\n                <Button minimal icon=\"confirm\" intent=\"primary\" onClick={() => {\n                    let process;\n                    if (isNew) {\n                        process = logCommentService.add(id, {\n                            content: value\n                        });\n                    } else {\n                        process = logCommentService.upd(cid, {\n                            content: value\n                        });\n                    }\n                    process.then(() => {\n                        h.goBack();\n                    }).catch(err => {\n                        alert(err.message);\n                    });\n                }}>提交</Button>\n            } />\n        }>\n            <div className={styles.container}>\n                {\n                    initState && <LogCommentEditor\n                        value={value}\n                        onChange={val => setValue(val)}\n                        placeholder=\"请从此出开始...\"\n                    />\n                }\n            </div>\n        </AppFrame>\n    );\n}\n","import React from 'react';\nimport styles from './index.module.css';\nimport { noop } from 'util/commonUtil';\nimport MarkdownEditor from 'component/markdownEditor';\n\nexport default function LogEditor(props) {\n    const { value = '', onChange = noop, placeholder = '', onConfirm = noop } = props;\n    return (\n        <div className={styles.container}>\n            <MarkdownEditor\n                value={value}\n                placeholder={placeholder}\n                onChange={val => onChange(val)}\n                onSubmit={() => onConfirm()}\n            />\n        </div>\n    );\n}","import React, { useState, useEffect } from 'react';\nimport { useHistory, useParams } from 'react-router-dom';\nimport { Button } from '@blueprintjs/core';\nimport styles from './logCreate.module.css';\nimport LogEditor from 'component/logEditor';\nimport AppFrame from 'component/appFrame';\nimport NormalNavigator from 'component/normalNavigator';\nimport logService from 'service/log';\nimport { AppToaster } from 'util/toaster';\n\nexport default function LogCreate() {\n    const h = useHistory();\n    const params = useParams();\n    const { id = null } = params;\n    const [ initState, setInitState ] = useState(false);\n    const [ isNew, setIsNew ] = useState(true);\n    const [ value, setValue ] = useState('');\n\n    useEffect(() => {\n        (async function() {\n            if (!id) {\n                setInitState(true);\n                return;\n            };\n            logService.get(id)\n                .then(m => {\n                    m && setValue(m.content);\n                    setIsNew(false);\n                })\n                .finally(() => {\n                    setInitState(true);\n                });\n        })();\n    }, [ id ]);\n    return (\n        <AppFrame header={\n            <NormalNavigator showBack actions={\n                <Button minimal intent=\"primary\" icon=\"confirm\" onClick={() => {\n                    let process;\n                    if (isNew) {\n                        process = logService.add({\n                            content: value\n                        });\n                    } else {\n                        process = logService.upd(id, {\n                            content: value\n                        });\n                    }\n                    process.then(() => {\n                        h.goBack();\n                    }).catch(err => {\n                        AppToaster.show({ timeout: 2000, message: err.message, intent: 'error' });\n                    });\n                }}>提交</Button>\n            } />\n        }>\n            <div className={styles.container}>\n                {\n                    initState && <LogEditor\n                        value={value}\n                        onChange={val => setValue(val)}\n                        placeholder=\"请由此开始...\"\n                    />\n                }\n            </div>\n        </AppFrame>\n    );\n}\n","import React from 'react';\nimport { Tooltip, Position } from '@blueprintjs/core';\nimport TimeAgo from 'timeago-react';\nimport dayjs from 'dayjs';\n\nexport default function(props) {\n    const { time = new Date(), showTooltip = true } = props;\n    return (\n        <Tooltip position={Position.TOP} disabled={!showTooltip} content={dayjs(time).format('YYYY.MM.DD HH:mm')} >\n            <TimeAgo datetime={time} locale='zh_CN' />\n        </Tooltip>\n    );\n}","/* eslint-disable jsx-a11y/anchor-is-valid  */\n\nimport React from 'react';\nimport styles from './index.module.css';\nimport names from 'classnames';\nimport { Classes, Icon, ButtonGroup, Button, Popover, Position, Divider } from '@blueprintjs/core';\nimport MarkdownPreview from 'component/markdownPreview';\nimport Ago from 'component/timeAgo';\nimport { noop } from 'util/commonUtil';\n\nfunction LogComment(props) {\n    const { comment: c, onRequestDelete = noop, onRequestUpdate = noop } = props;\n\n    return (\n        <div className={styles.comment} key={c.id}>\n            <div className={names(Classes.TEXT_MUTED, styles.commentMeta)}>\n                <div className={styles.commentMetaBlock}>\n                    <span className={styles.commentMetaItem}><Ago time={c.time} /></span>\n                </div>\n                <div className={names(styles.commentMetaBlock, styles.hoverVisible)}>\n                    <Popover content={\n                        <ButtonGroup>\n                            <Button minimal onClick={() => onRequestUpdate(c)}>编辑</Button>\n                            <Divider />\n                            <Button minimal intent=\"danger\" onClick={() => onRequestDelete(c.id)}>删除</Button>\n                        </ButtonGroup>\n                    } position={Position.TOP} interactionKind=\"hover\">\n                        <a\n                            className={names(\n                                styles.commentMetaItem,\n                                Classes.TEXT_MUTED,\n                                Classes.TEXT_SMALL\n                            )}\n                        >\n                            <Icon icon=\"more\" />\n                        </a>\n                    </Popover>\n                </div>\n            </div>\n            <div className={names(styles.commentContent, Classes.RUNNING_TEXT)}>\n                <MarkdownPreview source={c.content} />\n            </div>\n        </div>\n    );\n}\n\nexport default function LogComments(props) {\n    const { list = [], onRequestDelete, onRequestUpdate} = props;\n    return (\n        <div className={styles.comments}>\n            {\n                list.map(c => (\n                    <LogComment\n                        key={c.id}\n                        comment={c}\n                        onRequestDelete={onRequestDelete}\n                        onRequestUpdate={onRequestUpdate}\n                    />\n                ))\n            }\n        </div>\n    );\n}","\nconst REG = /(\\d+):(\\d+)-(\\d+):(\\d+)/;\n\nexport function sourcePosParse(sourcePosStr) {\n    const match = REG.exec(sourcePosStr);\n    if (!match) return null;\n    return {\n        startLine: Number(match[1]),\n        startIndex: Number(match[2]),\n        endLine: Number(match[3]),\n        endIndex: Number(match[4]),\n    }\n}\n\nexport function getRange(source, sourcePosStr) {\n    const sourceArr = source.split('\\n');\n    const sourcePos = sourcePosParse(sourcePosStr);\n    const range = {\n        from: sourceArr\n            .slice(0, sourcePos.startLine - 1)\n            .map(l => l.length)\n            .reduce((p, n) => p + n, 0) + (sourcePos.startLine - 1) + sourcePos.startIndex,\n        to: sourceArr\n            .slice(0, sourcePos.endLine - 1)\n            .map(l => l.length)\n            .reduce((p, n) => p + n, 0) + (sourcePos.endLine - 1) + sourcePos.endIndex,\n    };\n    return range;\n}\n\nexport function sliceCodeFromSource(source, sourcePosStr) {\n    const range = getRange(source, sourcePosStr);\n    return source.slice(range.from - 1, range.to - 1);\n}\nexport function replaceCodeFromSource(source, sourcePosStr, replacement) {\n    const range = getRange(source, sourcePosStr);\n    return source.slice(0, range.from - 1) + replacement + source.slice(range.to - 1);\n}","import React from 'react';\nimport MarkdownEditor from 'component/markdownEditor';\nimport { noop } from 'util/commonUtil';\nimport { Drawer, Position, Classes, Button} from '@blueprintjs/core';\n\nexport default function DrawerEditor(props) {\n    const {\n        isOpen = false,\n        onClose = noop,\n        value = '',\n        onChange = noop,\n        onConfirm = noop,\n        title = ''\n    } = props;\n    return (\n        <Drawer\n            icon=\"annotation\"\n            autoFocus\n            hasBackdrop\n            isOpen={isOpen}\n            position={Position.BOTTOM}\n            size=\"100%\"\n            onClose={onClose}\n            title={title}\n        >\n            <div\n                className={Classes.DRAWER_BODY}\n                style={{ height: '100%', padding: '0 15px' }}\n            >\n                <div style={{padding: '20px 0', maxWidth: 640, margin: 'auto'}}>\n                    <MarkdownEditor\n                        value={value}\n                        onChange={val => onChange(val)}\n                        onSubmit={() => onConfirm()}\n                    />\n                </div>\n                <div className=\"\">\n                    <div style={{\n                        display: 'flex',\n                        width: 640,\n                        margin: 'auto',\n                        alignItems: 'center'\n                    }}>\n                        <Button\n                            icon=\"confirm\"\n                            intent=\"primary\"\n                            className={Classes.DIALOG_CLOSE_BUTTON}\n                            onClick={onConfirm}\n                        >\n                            提交\n                        </Button>\n                    </div>\n                </div>\n            </div>\n        </Drawer>\n    );\n}\n","import React, { useEffect, useState } from 'react';\nimport { useHistory, useParams } from 'react-router-dom';\nimport {\n    Button, Classes, Switch, Position, Code, Popover, Menu, MenuItem, ButtonGroup, Tooltip\n} from '@blueprintjs/core';\nimport styles from './logDetail.module.css';\nimport AppFrame from 'component/appFrame';\nimport logService from 'service/log';\nimport logCommentService from 'service/logComment';\nimport LogComments from 'component/logComments';\nimport { AppToaster } from 'util/toaster';\nimport MarkdownPreview from 'component/markdownPreview';\nimport { sliceCodeFromSource, replaceCodeFromSource } from 'util/sourcePosUtil';\nimport NormalNavigator from 'component/normalNavigator';\n// import NormalFooter from 'component/normalFooter';\nimport getUrlUtil from 'util/getUrlUtil';\nimport Ago from 'component/timeAgo';\nimport DrawerEditor from 'component/drawerEditor';\nimport { noop } from 'util/commonUtil';\n\nconst NavigationActions = (props) => {\n    const h = useHistory();\n    const params = useParams();\n    const { onAppendRequest = noop } = props;\n    return (\n        < >\n            <Popover content={\n                <Menu>\n                    <MenuItem\n                        icon=\"add\" text=\"追加片段\" label={<><Code>⌘</Code> + <Code>a</Code></>}\n                        onClick={onAppendRequest}\n                    />\n                    <MenuItem\n                        icon=\"annotation\" text=\"编辑全部\" label={<><Code>⌘</Code> + <Code>e</Code></>}\n                        onClick={() => h.push(getUrlUtil.getLogCreateUrl(params.id))}\n                    />\n                    <Menu.Divider />\n                    <MenuItem\n                        icon=\"delete\" intent=\"danger\" text=\"删除日志\" label={<><Code>⌘</Code> + <Code>d</Code></>}\n                        onClick={() => {\n                            if (!window.confirm(\"确认删除？\")) return;\n                            logService.del(params.id)\n                                .then(() => {\n                                    AppToaster.show({ timeout: 2000, message: '删除成功', intent: 'success' });\n                                    h.goBack();\n                                })\n                                .catch(err => {\n                                    alert(err.message);\n                                });\n                        }}\n                    />\n                </Menu>\n            } position={Position.BOTTOM}>\n                <Button minimal icon=\"cog\" text=\"操作\" />\n            </Popover>\n        </>\n    );\n};\n\nexport default function LogDetail() {\n    const params = useParams();\n    const [flag, setFlag] = useState(false);\n    const [logData, setLogData] = useState(null);\n    const [logCommentsData, setLogCommentsData] = useState([]);\n    const [partialEdit, setPartialEdit] = useState(false);\n    const [isOpenPartialDrawerEditor, setIsOpenPartialDrawerEditor] = useState(false);\n    const [isOpenAppendDrawerEditor, setIsOpenAppendDrawerEditor] = useState(false);\n    const [isOpenCommentDrawerEditor, setIsOpenCommentDrawerEditor] = useState(false);\n    const [partialSource, setPartialSource] = useState('');\n    const [appendSource, setAppendSource] = useState('');\n    const [commentSource, setCommentSource] = useState('');\n    const [commentRefId, setCommentRefId] = useState('');\n    const [posData, setPosData] = useState(null);\n\n    useEffect(() => {\n        async function fetchData() {\n            const logInfo = await logService.get(params.id);\n            const logCommentsInfo = await logCommentService.all(params.id);\n            setLogData(logInfo);\n            setLogCommentsData(logCommentsInfo);\n        }\n        fetchData();\n    }, [params.id, flag]);\n    return (\n        <AppFrame\n            header={\n                <NormalNavigator\n                    showBack\n                    title={logData && <span className={Classes.TEXT_MUTED}><Ago time={logData.time} /></span>}\n                    leftActions={\n                        < >\n                            <ButtonGroup>\n                                <Button\n                                    icon=\"comment\"\n                                    text=\"评论\"\n                                    minimal\n                                    onClick={() => {\n                                        setCommentSource('');\n                                        setIsOpenCommentDrawerEditor(true);\n                                        setCommentRefId('');\n                                    }}\n                                ></Button>\n                            </ButtonGroup>\n                            <NavigationActions onAppendRequest={() => setIsOpenAppendDrawerEditor(true)} />\n                        </>\n                    }\n                    actions={\n                        <Tooltip content=\"片段编辑\">\n                            <Switch style={{ marginLeft: 5, marginBottom: 0 }} checked={partialEdit} onChange={() => setPartialEdit(!partialEdit)} />\n                        </Tooltip>\n                    }\n                />\n            }\n        >\n            {\n                logData && logCommentsData &&\n                <div className={styles.container}>\n                    <div className={styles.logContentBox}>\n                        <div className={styles.logContent}>\n                            <MarkdownPreview source={logData.content} selectAble={partialEdit} onSelect={\n                                pos => {\n                                    const partial = sliceCodeFromSource(logData.content, pos);\n                                    setIsOpenPartialDrawerEditor(true);\n                                    setPartialSource(partial);\n                                    setPosData(pos);\n                                }\n                            } />\n                        </div>\n                    </div>\n                    <div className={styles.commentBox}>\n                        <div className={styles.commentContent}>\n                            <LogComments\n                                list={logCommentsData}\n                                onRequestUpdate={c => {\n                                    setCommentSource(c.content);\n                                    setIsOpenCommentDrawerEditor(true);\n                                    setCommentRefId(c.id);\n                                }}\n                                onRequestDelete={cid => {\n                                    if (!window.confirm('你确定将此条记录删除吗？')) return;\n                                    logCommentService.del(cid)\n                                        .then(() => {\n                                            AppToaster.show({\n                                                timeout: 2000,\n                                                message: '删除成功',\n                                                intent: 'success'\n                                            });\n                                            setFlag(!flag);\n                                        })\n                                        .catch(err => {\n                                            alert(err.message);\n                                        });\n                                }}\n                            />\n                        </div>\n                    </div>\n                </div>\n            }\n            <DrawerEditor\n                title=\"编辑片段\"\n                isOpen={isOpenPartialDrawerEditor}\n                onClose={() => {\n                    setIsOpenPartialDrawerEditor(false);\n                }}\n                onConfirm={() => {\n                    setIsOpenPartialDrawerEditor(false);\n                    const source = replaceCodeFromSource(logData.content, posData, partialSource);\n                    logService\n                        .upd(logData.id, { content: source })\n                        .then(() => {\n                            setFlag(!flag);\n                            setPartialEdit(false);\n                        });\n                }}\n                value={partialSource}\n                onChange={val => setPartialSource(val)}\n            />\n            <DrawerEditor\n                title=\"追加片段\"\n                isOpen={isOpenAppendDrawerEditor}\n                onClose={() => {\n                    setIsOpenAppendDrawerEditor(false);\n                }}\n                onConfirm={() => {\n                    setIsOpenAppendDrawerEditor(false);\n                    logService\n                        .upd(logData.id, { content: logData.content + '\\n\\n' + appendSource })\n                        .then(() => {\n                            setFlag(!flag);\n                            setPartialEdit(false);\n                        });\n                }}\n                value={appendSource}\n                onChange={val => setAppendSource(val)}\n            />\n            <DrawerEditor\n                title={`${commentRefId ? '修改' : '发布'}评论`}\n                isOpen={isOpenCommentDrawerEditor}\n                onClose={() => {\n                    setIsOpenCommentDrawerEditor(false);\n                }}\n                onConfirm={() => {\n                    setIsOpenCommentDrawerEditor(false);\n                    let process;\n                    if (commentRefId) {\n                        process = logCommentService\n                            .upd(commentRefId, { content: commentSource });\n                    } else {\n                        process = logCommentService\n                            .add(logData.id, { content: commentSource });\n                    }\n                    process\n                        .then(() => {\n                            setFlag(!flag);\n                        });\n                }}\n                value={commentSource}\n                onChange={val => setCommentSource(val)}\n            />\n        </AppFrame>\n    );\n}","import React from 'react';\nimport { HashRouter as Router, Route, Redirect, Switch } from 'react-router-dom';\nimport AliaPage from './page/alia';\nimport LogPage from './page/log';\nimport LogCommentCreatePage from './page/logCommentCreate';\nimport LogCreatePage from './page/logCreate';\nimport LogDetailPage from './page/logDetail';\nimport 'normalize.css';\nimport '@blueprintjs/core/lib/css/blueprint.css';\nimport '@blueprintjs/icons/lib/css/blueprint-icons.css';\nimport '@blueprintjs/datetime/lib/css/blueprint-datetime.css';\n// import 'github-markdown-css';\n\nfunction App() {\n    return (\n        <Router>\n            <Switch>\n                <Route path=\"/l/l\" component={LogPage} />\n                <Route path=\"/l/d/:id\" component={LogDetailPage} />\n                <Route path=\"/l/a/:text\" component={AliaPage} />\n                <Route path=\"/l/ce/:id?\" component={LogCreatePage} />\n                <Route path=\"/l/lc/ce/:id/:cid?\" component={LogCommentCreatePage} />\n                <Redirect to=\"/l/a/m\" />\n            </Switch>\n        </Router>\n    );\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"logDetail_container__w0WFV\",\"logContentBox\":\"logDetail_logContentBox__2FBOS\",\"logContent\":\"logDetail_logContent__2q741\",\"meta\":\"logDetail_meta__IpNSK\",\"commentBox\":\"logDetail_commentBox__2xmER\",\"commentContent\":\"logDetail_commentContent__2yOe-\",\"footerActions\":\"logDetail_footerActions__ax9Jf\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"appFrame_container__28Uto\",\"header\":\"appFrame_header__VXnlL\",\"body\":\"appFrame_body__1wP9K\",\"footer\":\"appFrame_footer__PUQHy\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"markdownBody\":\"markdownPreview_markdownBody__3D-P7\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"logItem_container__1HQ_G\",\"metaBlock\":\"logItem_metaBlock__19X2m\",\"meta\":\"logItem_meta__JAOjF\",\"metaItem\":\"logItem_metaItem__37psE\",\"markdownBody\":\"logItem_markdownBody__1O-pH\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"markdownEditor_container__1Bh7Q\",\"editorBox\":\"markdownEditor_editorBox__2jfkZ\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"alia_container__3sOFO\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"log_container__1snyH\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"logCommentCreate_container__3qGs1\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"textarea\":\"logCommentEditor_textarea__ltzcQ\",\"container\":\"logCommentEditor_container__3s0iH\",\"buttonWrap\":\"logCommentEditor_buttonWrap__o5tot\"};"],"sourceRoot":""}